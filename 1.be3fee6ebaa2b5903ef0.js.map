{"version":3,"sources":["webpack:///./render.js","webpack:///./ui.js","webpack:///./main.js","webpack:///../engine/pkg/engine_bg.js"],"names":["reglBuilder","require","$","canvas","document","getElementById","selectedElement","Element","Sand","paused","playButton","pauseButton","nextFrameButton","hide","addClass","click","togglePause","nextTick","map","clear","window","show","removeClass","change","Empty","Wall","painting","lastPaint","repeat","addEventListener","event","preventDefault","clearInterval","setInterval","paint","body","startEvent","clientX","clientY","i","eventDistance","d","add","scale","norm","sub","Math","min","smoothPaint","boundingRect","getBoundingClientRect","scaleX","width","ceil","devicePixelRatio","scaleY","height","canvasLeft","left","canvasTop","top","x","floor","y","insert","a","b","sqrt","pow","mag","magnitude","s","Map","regl","ptr_pixels","pixels","dataTexture","drawMap","Uint8Array","memory","buffer","texture","data","frag","vert","uniforms","attributes","position","count","poll","tick","renderLoop","animationId","requestAnimationFrame","heap","Array","fill","undefined","getObject","idx","push","heap_next","length","takeObject","ret","dropObject","cachedTextDecoder","TextDecoder","module","ignoreBOM","fatal","decode","cachegetUint8Memory0","getUint8Memory0","wasm","getStringFromWasm0","ptr","len","subarray","WASM_VECTOR_LEN","cachedTextEncoder","TextEncoder","encodeString","encodeInto","arg","view","buf","encode","set","read","written","cachegetInt32Memory0","getInt32Memory0","Int32Array","Object","freeze","this","element","Pixel","__wrap","PixelState","obj","create","prototype","__wbg_new_59cb74e423758ede","addHeapObject","Error","__wbg_stack_558ba5917b466edd","arg0","arg1","ptr0","malloc","realloc","mem","offset","code","charCodeAt","slice","passStringToWasm0","stack","len0","__wbg_error_4bb6c2a97407129a","console","error","__wbindgen_object_drop_ref","__wbindgen_throw"],"mappings":"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","file":"1.be3fee6ebaa2b5903ef0.js","sourcesContent":["const reglBuilder = require(\"regl\");\r\nimport { memory } from \"./node_modules/engine/engine_bg\";\r\n\r\nlet startWebGL = ({ canvas, map }) => {\r\n    const regl = reglBuilder({\r\n        canvas\r\n    });\r\n\r\n    const width = map.width();\r\n    const height = map.height();\r\n    let ptr_pixels = map.pixels();\r\n    let pixels = new Uint8Array(memory.buffer, ptr_pixels, width * height * 4);\r\n    const dataTexture = regl.texture({ width, height, data: pixels });\r\n\r\n    let drawMap = regl({\r\n        frag: `\r\n        precision highp float;\r\n        uniform sampler2D data;\r\n        varying vec2 uv;\r\n        void main() {\r\n            vec2 textCoord = (uv * vec2(0.5, -0.5)) + vec2(0.5);\r\n            vec4 data = texture2D(data, textCoord);\r\n            int element = int((data.r * 255.) + 0.1);\r\n            vec4 color;\r\n            \r\n            // empty\r\n            if (element == 0) {\r\n                color = vec4(255, 255, 255, 1);\r\n            }\r\n            \r\n            if (element == 1) {\r\n                color = vec4(0, 0, 0, 1);\r\n            }\r\n            \r\n            // sand\r\n            if (element == 2) {\r\n                color = vec4(0.76, 0.7, 0.5, 1);\r\n            }\r\n            \r\n            gl_FragColor = color;\r\n        }`,\r\n\r\n        vert: `\r\n        precision mediump float;\r\n        attribute vec2 position;\r\n        varying vec2 uv;\r\n        void main() {\r\n            uv = position;\r\n            gl_Position = vec4(position, 0, 1);\r\n        }`,\r\n\r\n        uniforms: {\r\n            data: () => {\r\n                ptr_pixels = map.pixels();\r\n                pixels = new Uint8Array(memory.buffer, ptr_pixels, width * height * 4);\r\n\r\n                return dataTexture({width, height, data: pixels});\r\n            },\r\n        },\r\n\r\n        attributes: {\r\n            position: [[-1, 4], [-1, -1], [4, -1]]\r\n        },\r\n\r\n        count: 3,\r\n    });\r\n\r\n    return () => {\r\n        regl.poll();\r\n        drawMap();\r\n    };\r\n};\r\n\r\nexport { startWebGL};","var $ = require( \"jquery\" );\r\n\r\nimport { width, height, map, nextTick } from \"./main.js\";\r\nimport { Element } from \"./node_modules/engine/engine.js\";\r\n\r\nconst canvas = document.getElementById(\"canvas\");\r\n\r\nlet selectedElement = Element.Sand;\r\n\r\nlet paused = false;\r\nlet playButton = $('#play')\r\nlet pauseButton = $('#pause')\r\nlet nextFrameButton = $('#nextFrame')\r\n\r\nplayButton.hide();\r\nnextFrameButton.addClass(\"disabled\");\r\n\r\nplayButton.click(() => togglePause());\r\npauseButton.click(() => togglePause());\r\n\r\nnextFrameButton.click(() => {\r\n    if (paused) {\r\n        nextTick();\r\n    }\r\n});\r\n\r\n$('#reset').click(() => map.clear());\r\n\r\nconst togglePause = () => {\r\n    paused = !paused;\r\n    window.paused = paused;\r\n\r\n    if (paused) {\r\n        playButton.show();\r\n        pauseButton.hide();\r\n        nextFrameButton.removeClass(\"disabled\");\r\n    } else {\r\n        playButton.hide();\r\n        pauseButton.show();\r\n        nextFrameButton.addClass(\"disabled\");\r\n    }\r\n}\r\n\r\n$('#emptyElement').change(() => selectedElement = Element.Empty);\r\n$('#wallElement').change(() => selectedElement = Element.Wall);\r\n$('#sandElement').change(() => selectedElement = Element.Sand);\r\n\r\nlet painting = false;\r\nlet lastPaint = null;\r\nlet repeat = null;\r\n\r\ncanvas.addEventListener(\"mousedown\", event => {\r\n    event.preventDefault();\r\n    painting = true;\r\n    clearInterval(repeat);\r\n    repeat = window.setInterval(() => paint(event), 100);\r\n    paint(event);\r\n    lastPaint = event;\r\n});\r\n\r\ndocument.body.addEventListener(\"mouseup\", event => {\r\n    clearInterval(repeat);\r\n    if (painting) {\r\n        event.preventDefault();\r\n        lastPaint = null;\r\n        painting = false;\r\n    }\r\n});\r\n\r\ncanvas.addEventListener(\"mousemove\", event => {\r\n    clearInterval(repeat);\r\n    smoothPaint(event);\r\n});\r\n\r\ncanvas.addEventListener(\"mouseleave\", event => {\r\n    clearInterval(repeat);\r\n    lastPaint = null;\r\n});\r\n\r\nconst paint = event => {\r\n    if (!painting) {\r\n        return;\r\n    }\r\n    const boundingRect = canvas.getBoundingClientRect();\r\n\r\n    const scaleX = canvas.width / Math.ceil(window.devicePixelRatio) / boundingRect.width;\r\n    const scaleY = canvas.height / Math.ceil(window.devicePixelRatio) / boundingRect.height;\r\n\r\n    const canvasLeft = (event.clientX - boundingRect.left) * scaleX;\r\n    const canvasTop = (event.clientY - boundingRect.top) * scaleY;\r\n\r\n    const x = Math.min(Math.floor(canvasLeft), width - 1);\r\n    const y = Math.min(Math.floor(canvasTop), height - 1);\r\n\r\n    map.insert(x, y, selectedElement);\r\n};\r\n\r\nfunction smoothPaint(event) {\r\n    clearInterval(repeat);\r\n    repeat = window.setInterval(() => paint(event), 100);\r\n\r\n    let startEvent = { clientX: event.clientX, clientY: event.clientY };\r\n\r\n    if (!painting) {\r\n        return;\r\n    }\r\n\r\n    let i = 0;\r\n    paint(startEvent);\r\n\r\n    if (lastPaint) {\r\n        while (eventDistance(startEvent, lastPaint) > 1 / 3) {\r\n            let d = eventDistance(startEvent, lastPaint);\r\n            startEvent = add(\r\n                startEvent,\r\n                scale(norm(sub(lastPaint, event)), Math.min(1 / 3, d))\r\n            );\r\n            i++;\r\n            if (i > 1000) {\r\n                break;\r\n            }\r\n            paint(startEvent);\r\n        }\r\n    }\r\n    lastPaint = event;\r\n}\r\n\r\nconst eventDistance = (a, b) => {\r\n    return Math.sqrt(\r\n        Math.pow(a.clientX - b.clientX, 2) + Math.pow(a.clientY - b.clientY, 2),\r\n        2\r\n    );\r\n};\r\n\r\nconst add = (a, b) => {\r\n    return { clientX: a.clientX + b.clientX, clientY: a.clientY + b.clientY };\r\n};\r\n\r\nconst sub = (a, b) => {\r\n    return { clientX: a.clientX - b.clientX, clientY: a.clientY - b.clientY };\r\n};\r\n\r\nconst norm = a => {\r\n    let mag = magnitude(a);\r\n    return { clientX: a.clientX / mag, clientY: a.clientY / mag };\r\n};\r\n\r\nconst scale = (a, s) => {\r\n    return { clientX: a.clientX * s, clientY: a.clientY * s };\r\n};\r\n\r\nconst magnitude = a => {\r\n    return Math.sqrt(Math.pow(a.clientX, 2) + Math.pow(a.clientY, 2), 2);\r\n};","import { Map } from \"./node_modules/engine/engine.js\";\r\nimport { startWebGL } from \"./render\";\r\nimport {} from \"./ui\";\r\n\r\nlet width = 100;\r\nlet height = 100;\r\nconst map = Map.new(width, height);\r\n\r\nconst canvas = document.getElementById(\"canvas\");\r\n\r\ncanvas.width = width * Math.ceil(window.devicePixelRatio);\r\ncanvas.height = height * Math.ceil(window.devicePixelRatio);\r\n\r\nlet drawMap = startWebGL({ canvas, map });\r\n\r\nconst renderLoop = () => {\r\n    if (!window.paused) {\r\n        nextTick();\r\n    }\r\n\r\n    drawMap();\r\n    window.animationId = requestAnimationFrame(renderLoop);\r\n};\r\n\r\nconst nextTick = () => {\r\n    map.tick();\r\n}\r\n\r\nrenderLoop();\r\n\r\nexport { canvas, width, height, map, nextTick};","import * as wasm from './engine_bg.wasm';\n\nconst heap = new Array(32).fill(undefined);\n\nheap.push(undefined, null, true, false);\n\nfunction getObject(idx) { return heap[idx]; }\n\nlet heap_next = heap.length;\n\nfunction dropObject(idx) {\n    if (idx < 36) return;\n    heap[idx] = heap_next;\n    heap_next = idx;\n}\n\nfunction takeObject(idx) {\n    const ret = getObject(idx);\n    dropObject(idx);\n    return ret;\n}\n\nconst lTextDecoder = typeof TextDecoder === 'undefined' ? (0, module.require)('util').TextDecoder : TextDecoder;\n\nlet cachedTextDecoder = new lTextDecoder('utf-8', { ignoreBOM: true, fatal: true });\n\ncachedTextDecoder.decode();\n\nlet cachegetUint8Memory0 = null;\nfunction getUint8Memory0() {\n    if (cachegetUint8Memory0 === null || cachegetUint8Memory0.buffer !== wasm.memory.buffer) {\n        cachegetUint8Memory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachegetUint8Memory0;\n}\n\nfunction getStringFromWasm0(ptr, len) {\n    return cachedTextDecoder.decode(getUint8Memory0().subarray(ptr, ptr + len));\n}\n\nfunction addHeapObject(obj) {\n    if (heap_next === heap.length) heap.push(heap.length + 1);\n    const idx = heap_next;\n    heap_next = heap[idx];\n\n    heap[idx] = obj;\n    return idx;\n}\n\nlet WASM_VECTOR_LEN = 0;\n\nconst lTextEncoder = typeof TextEncoder === 'undefined' ? (0, module.require)('util').TextEncoder : TextEncoder;\n\nlet cachedTextEncoder = new lTextEncoder('utf-8');\n\nconst encodeString = (typeof cachedTextEncoder.encodeInto === 'function'\n    ? function (arg, view) {\n    return cachedTextEncoder.encodeInto(arg, view);\n}\n    : function (arg, view) {\n    const buf = cachedTextEncoder.encode(arg);\n    view.set(buf);\n    return {\n        read: arg.length,\n        written: buf.length\n    };\n});\n\nfunction passStringToWasm0(arg, malloc, realloc) {\n\n    if (realloc === undefined) {\n        const buf = cachedTextEncoder.encode(arg);\n        const ptr = malloc(buf.length);\n        getUint8Memory0().subarray(ptr, ptr + buf.length).set(buf);\n        WASM_VECTOR_LEN = buf.length;\n        return ptr;\n    }\n\n    let len = arg.length;\n    let ptr = malloc(len);\n\n    const mem = getUint8Memory0();\n\n    let offset = 0;\n\n    for (; offset < len; offset++) {\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = realloc(ptr, len, len = offset + arg.length * 3);\n        const view = getUint8Memory0().subarray(ptr + offset, ptr + len);\n        const ret = encodeString(arg, view);\n\n        offset += ret.written;\n    }\n\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\n\nlet cachegetInt32Memory0 = null;\nfunction getInt32Memory0() {\n    if (cachegetInt32Memory0 === null || cachegetInt32Memory0.buffer !== wasm.memory.buffer) {\n        cachegetInt32Memory0 = new Int32Array(wasm.memory.buffer);\n    }\n    return cachegetInt32Memory0;\n}\n/**\n*/\nexport const Element = Object.freeze({ Empty:0,\"0\":\"Empty\",Wall:1,\"1\":\"Wall\",Sand:2,\"2\":\"Sand\", });\n/**\n*/\nexport class Map {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Map.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_map_free(ptr);\n    }\n    /**\n    * @param {number} width\n    * @param {number} height\n    * @returns {Map}\n    */\n    static new(width, height) {\n        var ret = wasm.map_new(width, height);\n        return Map.__wrap(ret);\n    }\n    /**\n    * @param {number} x\n    * @param {number} y\n    * @param {number} element\n    */\n    insert(x, y, element) {\n        wasm.map_insert(this.ptr, x, y, element);\n    }\n    /**\n    */\n    clear() {\n        wasm.map_clear(this.ptr);\n    }\n    /**\n    */\n    tick() {\n        wasm.map_tick(this.ptr);\n    }\n    /**\n    * @returns {number}\n    */\n    width() {\n        var ret = wasm.map_width(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    height() {\n        var ret = wasm.map_height(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    generation() {\n        var ret = wasm.map_generation(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    pixels() {\n        var ret = wasm.map_pixels(this.ptr);\n        return ret;\n    }\n    /**\n    * @param {number} x\n    * @param {number} y\n    * @returns {Pixel}\n    */\n    get_pixel(x, y) {\n        var ret = wasm.map_get_pixel(this.ptr, x, y);\n        return Pixel.__wrap(ret);\n    }\n    /**\n    * @param {number} x\n    * @param {number} y\n    * @returns {PixelState}\n    */\n    get_pixel_state(x, y) {\n        var ret = wasm.map_get_pixel_state(this.ptr, x, y);\n        return PixelState.__wrap(ret);\n    }\n}\n/**\n*/\nexport class Pixel {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Pixel.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_pixel_free(ptr);\n    }\n    /**\n    * @param {number} element\n    * @returns {Pixel}\n    */\n    static new(element) {\n        var ret = wasm.pixel_new(element);\n        return Pixel.__wrap(ret);\n    }\n    /**\n    * @returns {number}\n    */\n    element() {\n        var ret = wasm.pixel_element(this.ptr);\n        return ret >>> 0;\n    }\n}\n/**\n*/\nexport class PixelState {\n\n    static __wrap(ptr) {\n        const obj = Object.create(PixelState.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_pixelstate_free(ptr);\n    }\n    /**\n    * @param {number} element\n    * @returns {PixelState}\n    */\n    static new(element) {\n        var ret = wasm.pixel_new(element);\n        return PixelState.__wrap(ret);\n    }\n    /**\n    * @returns {number}\n    */\n    element() {\n        var ret = wasm.pixel_element(this.ptr);\n        return ret >>> 0;\n    }\n    /**\n    * @returns {number}\n    */\n    clock() {\n        var ret = wasm.pixelstate_clock(this.ptr);\n        return ret;\n    }\n}\n\nexport const __wbg_new_59cb74e423758ede = function() {\n    var ret = new Error();\n    return addHeapObject(ret);\n};\n\nexport const __wbg_stack_558ba5917b466edd = function(arg0, arg1) {\n    var ret = getObject(arg1).stack;\n    var ptr0 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    var len0 = WASM_VECTOR_LEN;\n    getInt32Memory0()[arg0 / 4 + 1] = len0;\n    getInt32Memory0()[arg0 / 4 + 0] = ptr0;\n};\n\nexport const __wbg_error_4bb6c2a97407129a = function(arg0, arg1) {\n    try {\n        console.error(getStringFromWasm0(arg0, arg1));\n    } finally {\n        wasm.__wbindgen_free(arg0, arg1);\n    }\n};\n\nexport const __wbindgen_object_drop_ref = function(arg0) {\n    takeObject(arg0);\n};\n\nexport const __wbindgen_throw = function(arg0, arg1) {\n    throw new Error(getStringFromWasm0(arg0, arg1));\n};\n\n"],"sourceRoot":""}